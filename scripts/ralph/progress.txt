## Codebase Patterns

### Admin Panel Pattern
- Admin pages should check `user?.is_superuser` and redirect non-superusers immediately with toast error
- Use consistent stat card design with color-coded backgrounds (blue, green, purple, orange, red, cyan)
- Auto-refresh data every 5 minutes for statistics, 30 seconds for health status
- Admin navigation cards link to other admin tools with clear descriptions
- Charts use SVG bar charts with consistent styling (viewBox, rx for rounded corners)

### Component Architecture
- Page components export both named export (for imports) and default export (for lazy loading)
- Use `useCallback` for fetch functions to prevent unnecessary re-renders
- Implement loading states with `loading` and `isRefreshing` flags for better UX
- Error states should include retry functionality
- Auto-refresh intervals should be cleaned up in useEffect return function

### User Management Pattern
- User tables should display: username, email, full_name, is_active, is_superuser, created_at
- Status badges use color coding: green for active, red for inactive, yellow for superuser
- Search should filter across username, email, and full_name fields
- Filters for active/inactive status and superuser status
- User detail modal shows profile info, stats (team count, league count), and activity history
- Cannot modify own account (protect against self-deactivation)
- Confirmation dialogs required for all sensitive operations (activate/deactivate, grant/revoke superuser)
- Toast notifications for all success/error feedback

### Landing Page Pattern
- Landing pages for non-authenticated users should be at root URL (/)
- Hero section with strong value proposition and clear CTA buttons
- Features section highlighting key product benefits with icons
- How It Works section with step-by-step numbered guide
- Statistics section showing platform growth (fetched from API)
- Email capture form that checks if email exists before redirecting
- Update Login and Register pages to handle email state from LandingPage redirects
- Responsive design with mobile-first approach
- Footer with navigation links (disabled state for coming soon)

### Password Reset Pattern
- Forgot password page should use security-aware messaging (don't reveal if email exists)
- Reset password page extracts token from URL query params
- Password validation should match registration requirements (8+ chars, uppercase, lowercase, digit)
- Confirm password field with matching validation
- Auto-redirect to login page after successful reset with countdown timer
- Handle expired/invalid tokens gracefully with user-friendly error messages
- Add routes as public routes (accessible without authentication)
- Link from Login page to Forgot Password page
- Use error boundary pattern: catch block without parameter name to avoid lint errors

---

## 2/2/2026, 4:42 AM - US-044: Password Reset Flow
- **Implemented complete Password Reset Flow:**
  - Created ForgotPassword.tsx page component at /forgot-password route
    - Email input form with validation
    - Security-aware success message (doesn't reveal if email exists - prevents email enumeration attacks)
    - Error handling with user-friendly messages
    - Back to login link
    - Redirects authenticated users to dashboard
  - Created ResetPassword.tsx page component at /reset-password route
    - Extracts reset token from URL query params (?token=xxx)
    - New password input with validation (same rules as registration: 8+ chars, 1 uppercase, 1 lowercase, 1 digit)
    - Confirm password field with matching validation
    - Shows error if token is missing or invalid
    - Success message with countdown timer (3 seconds) before auto-redirect to login
    - Go to login now button for immediate redirect
  - Updated authService.ts with new methods:
    - forgotPassword(email): POST /api/v1/auth/forgot-password
    - resetPassword(token, new_password): POST /api/v1/auth/reset-password
  - Added TypeScript types to types/index.ts:
    - ForgotPasswordRequest interface
    - ResetPasswordRequest interface
  - Updated App.tsx:
    - Added public routes for /forgot-password and /reset-password
    - Routes accessible without authentication
  - Updated Login.tsx:
    - Added "Forgot your password?" link below password field
    - Styled with existing link pattern
  - Mobile responsive design with MobileNav component on both pages

- **Files changed:**
  - `frontend/src/pages/ForgotPassword.tsx` - New forgot password page
  - `frontend/src/pages/ResetPassword.tsx` - New reset password page
  - `frontend/src/App.tsx` - Added routes for forgot-password and reset-password
  - `frontend/src/services/authService.ts` - Added forgotPassword and resetPassword methods
  - `frontend/src/types/index.ts` - Added ForgotPasswordRequest and ResetPasswordRequest types
  - `frontend/src/pages/Login.tsx` - Added Forgot Password link

- **Quality checks:**
  - ✅ TypeScript check passed (npx tsc --noEmit)
  - ✅ No linting errors
  - ✅ Updated prd.json to mark US-044 as passing

- **Learnings for future iterations:**
  - Security consideration: Always show same success message for forgot password regardless of whether email exists
  - Token extraction: Use `useSearchParams()` hook from react-router-dom to get query params
  - Auto-redirect pattern: Use useEffect with countdown state, decrement every second, navigate when reaches 0
  - Password validation reuse: Import validation functions from authService to ensure consistency
  - Error handling for auth flows: Use unknown type for catch blocks, check instanceof Error
  - Public routes: Add to Routes before ProtectedRoute wrapper to allow unauthenticated access
  - Form validation: Validate confirm password matches new password before API call
  - Token expiration: Backend handles token validation, frontend shows appropriate error message

---

## 2/2/2026, 4:40 AM - US-043: Homepage & Landing Page
- **Implemented complete Landing Page for non-authenticated visitors:**
  - Created LandingPage.tsx page component at / (root URL) route
  - Features implemented:
    - Hero section with animated gradient background, app name (F1Fantasy), tagline ('Draft. Compete. Win.')
    - Primary CTA buttons: Get Started (blue) and Log In (white outline)
    - Features section with 4 cards: Draft Drivers, Compete in Leagues, Real-Time Scoring, Track Performance
    - How It Works section with 4-step numbered guide: Create Account, Join or Create League, Draft Your Team, Score Points & Win
    - Statistics section showing platform stats: Total Users, Active Leagues, Total Races (fetched from /api/v1/admin/stats)
    - Email capture form with validation and API integration:
      - Check if email exists via GET /api/v1/auth/check-email
      - Redirects to Login if email exists (with pre-filled email)
      - Redirects to Register if email is new (with pre-filled email)
      - Loading state during API call
      - Error handling for invalid email format
    - Footer with navigation links: About, Help, Privacy Policy, Terms of Service (disabled for coming soon)
    - Responsive design: hamburger menu on mobile, stacked layouts
    - Auto-redirect to Dashboard for already authenticated users
  - Updated App.tsx to route root URL to LandingPage for unauthenticated users
  - Updated Login.tsx to accept and display email from LandingPage redirect state
  - Updated Register.tsx to accept and pre-fill email from LandingPage redirect state
  - Added authService.checkEmail method for email verification
  - Added CheckEmailResponse type to types/index.ts
  - Comprehensive CSS styling for all landing page sections with animations

- **Files changed:**
  - `frontend/src/pages/LandingPage.tsx` - New landing page component
  - `frontend/src/App.tsx` - Updated root route to conditionally render LandingPage
  - `frontend/src/services/authService.ts` - Added checkEmail method
  - `frontend/src/types/index.ts` - Added CheckEmailResponse type
  - `frontend/src/pages/Login.tsx` - Added support for prefillEmail from location state
  - `frontend/src/pages/Register.tsx` - Added support for prefillEmail from location state
  - `frontend/src/index.css` - Added extensive CSS for landing page sections

- **Quality checks:**
  - ✅ TypeScript check passed (npx tsc --noEmit)
  - ✅ No linting errors
  - ✅ Updated prd.json to mark US-043 as passing

- **Learnings for future iterations:**
  - Landing page should be at root URL (/) and check authentication state
  - Use `useLocation` and `navigate('/login', { state: { email } })` to pass data between pages
  - Email capture API pattern: Check existence → Redirect to appropriate auth page with email state
  - Hero section benefits from animated backgrounds (CSS gradients + keyframes)
  - Statistics from existing APIs can enhance landing page credibility
  - Consistent CTA styling: Primary (blue filled) and Secondary (white outline) buttons
  - Footer links should be disabled with "coming soon" tooltips if pages don't exist yet
  - Responsive landing pages need mobile-first design with hamburger navigation

---

## 2/2/2026, 3:52 AM - US-042: Admin Dashboard - User Management
- **Implemented Admin Users page for viewing and managing platform users:**
  - Created AdminUsers.tsx page component at /admin/users route
  - Features implemented:
    - Superuser-only access with automatic redirect for non-superusers
    - Paginated user list (20 users per page) with columns:
      - Username (with user icon)
      - Email (with mail icon)
      - Full Name (with person icon)
      - Active Status (color-coded badge: green active, red inactive)
      - Superuser Status (gold star badge)
      - Created At (formatted date)
    - Search functionality filtering by username, email, or full name
    - Filter by Active/Inactive status
    - Filter by Superuser/Regular user status
    - User detail modal showing:
      - Profile information (username, email, full name, creation date)
      - Statistics: Team Count, League Count, Status, Role
      - Activity history with timestamps and icons:
        - League joins
        - Invitations sent
        - Draft picks made
        - Teams created
    - Activate/Deactivate user accounts:
      - Toggle button in user detail modal
      - Confirmation dialog with warning
      - Cannot deactivate own account (disabled with tooltip)
    - Grant/Revoke superuser privileges:
      - Toggle button in user detail modal
      - Confirmation dialog with warning about elevated permissions
      - Cannot modify own superuser status (disabled with tooltip)
    - Loading states with PageLoader component
    - Error handling with retry functionality via ErrorDisplay component
    - Toast notifications for success/error feedback
    - Admin navigation cards linking to other admin tools
    - Responsive design with MobileNav component

- **Files changed:**
  - `frontend/src/pages/AdminUsers.tsx` - New user management page
  - `frontend/src/App.tsx` - Added import and route for /admin/users
  - `frontend/src/services/adminService.ts` - Added getUsers, updateUserStatus methods
  - `frontend/src/types/admin.ts` - Added UserFilters, UserListResponse, UpdateUserRequest types

- **Quality checks:**
  - ✅ TypeScript check passed (npx tsc --noEmit)
  - ✅ No linting errors
  - ✅ Updated prd.json to mark US-042 as passing

- **Learnings for future iterations:**
  - User management follows table → detail modal → action pattern
  - Status badges: Green (#22c55e) for active, Red (#ef4444) for inactive, Gold (#f59e0b) for superuser
  - Icons from Lucide React add visual clarity to user attributes (User, Mail, UserCircle, Shield)
  - Activity history with icons helps admins quickly understand user engagement
  - Self-protection: Always disable actions on own account to prevent accidental lockout
  - Confirmation dialogs should explain consequences clearly
  - Stats cards in detail modal give quick overview of user's platform activity
  - Following AdminErrorLogs and AdminHealth patterns ensures consistency across admin panel

---

## 2/2/2026, 1:26 AM - US-041: Admin Dashboard - System Health Monitoring
- **Implemented Admin Health page for monitoring system component status:**
  - Created AdminHealth.tsx page component at /admin/health route
  - Features implemented:
    - Superuser-only access with automatic redirect for non-superusers
    - Overall system status banner with color coding (green/yellow/red)
    - 4 component health cards: API Service, Database, Redis Cache, Celery Task Queue
    - Each card displays: status badge, response time in ms, optional message
    - Visual status indicators with icons (✓/⚠/✕)
    - Alert banners for unhealthy components (red) and degraded components (yellow)
    - Auto-refresh every 30 seconds with cleanup on unmount
    - Manual refresh button with loading state
    - Last checked timestamp display
    - Status legend explaining healthy/degraded/unhealthy states
    - Admin navigation cards linking to other admin tools
    - Loading states with PageLoader component
    - Error handling with retry functionality via ErrorDisplay component
    - Mobile responsive design with MobileNav component

- **Files changed:**
  - `frontend/src/pages/AdminHealth.tsx` - New system health monitoring page
  - `frontend/src/App.tsx` - Added import and route for /admin/health

- **Quality checks:**
  - ✅ TypeScript check passed (npx tsc --noEmit)
  - ✅ No linting errors
  - ✅ Updated prd.json to mark US-041 as passing

- **Learnings for future iterations:**
  - Health monitoring pattern: Status banner → Alert banners → Component cards → Legend
  - Color coding: Green (#22c55e) for healthy, yellow (#f59e0b) for degraded, red (#ef4444) for unhealthy
  - Auto-refresh interval of 30 seconds is appropriate for health monitoring (vs 5 minutes for stats)
  - Component cards should show response time prominently as it's the key metric
  - Alert banners help draw attention to issues without being too intrusive
  - Status legend is important for user education on what each status means
  - Following the same patterns as AdminDashboard and AdminErrorLogs ensures consistency

---

## 2/2/2026, 12:15 AM - US-039: Admin Dashboard - Platform Statistics
- **Verified US-039 was already fully implemented:**
  - AdminDashboard.tsx page component at /admin route
  - All 6 statistics displayed with stat cards:
    - Total Users (blue card)
    - Active Users - 7 days (green card)
    - Total Leagues (purple card)
    - Active Leagues (orange card)
    - Completed Races (red card)
    - Upcoming Races (cyan card)
  - SVG bar charts for user registrations and league creations (last 30 days)
  - Auto-refresh every 5 minutes with cleanup on unmount
  - Manual refresh button with loading state
  - Last updated timestamp display
  - Admin navigation cards to Error Logs, System Health, User Management
  - Superuser-only access with redirect

- **Files changed:**
  - `frontend/src/pages/AdminDashboard.tsx` - Already existed with full implementation
  - `frontend/src/App.tsx` - Route already existed
  - `frontend/src/services/adminService.ts` - getStats method already existed
  - `frontend/src/types/admin.ts` - AdminStats type already existed

- **Quality checks:**
  - ✅ TypeScript check passed (npx tsc --noEmit)
  - ✅ No linting errors
  - ✅ Updated prd.json to mark US-039 as passing

- **Learnings for future iterations:**
  - This story was already complete when we started - checking existing code is crucial before starting work
  - AdminDashboard follows a consistent pattern: stat cards grid → charts section → admin navigation cards
  - SVG bar charts are implemented with viewBox for responsiveness and rx attributes for rounded corners
  - Auto-refresh pattern: useEffect with setInterval, cleanup in return function
  - Superuser check: redirect immediately in useEffect if not superuser

---

## 2/1/2026, 11:45 PM - US-040: Admin Dashboard - Error Logs Management
- **Implemented Admin Error Logs page for viewing and managing system error logs:**
  - Created AdminErrorLogs.tsx page component at /admin/error-logs route
  - Features implemented:
    - Paginated table displaying error logs with columns: timestamp, error_type, message, endpoint, user, severity, status
    - 50 logs per page with Previous/Next pagination controls
    - Comprehensive filters:
      - Severity filter: All, Error, Warning, Info
      - Status filter: All, Resolved, Unresolved
      - Error Type filter: Partial match text search
      - Endpoint filter: Partial match text search
      - User ID filter: Exact match text search
      - Date Range filter: Start date and end date pickers
    - Click any row to open error detail modal showing:
      - Full error details (severity, status, timestamp, error type, message)
      - Stack trace display in code block format
      - Request data (JSON formatted)
      - Response data (JSON formatted)
      - Resolution information (who resolved, when, notes)
    - Resolve/Unresolve functionality:
      - Mark as Resolved with optional resolution notes textarea
      - Mark as Unresolved to reopen errors
      - Shows resolver username and timestamp for resolved errors
    - Export to CSV functionality:
      - Exports filtered results to CSV file
      - Includes all relevant fields (timestamp, severity, status, error type, message, endpoint, user ID)
      - Downloads file with date-stamped filename
    - Superuser-only access with automatic redirect for non-superusers
    - Loading states and error handling with retry option
    - Empty state when no errors match filters
    - Toast notifications for success/error feedback

- **Files changed:**
  - `frontend/src/pages/AdminErrorLogs.tsx` - New error logs management page
  - `frontend/src/App.tsx` - Added import and route for /admin/error-logs
  - `frontend/src/services/adminService.ts` - Added getErrorLogs, resolveError, unresolveError methods
  - `frontend/src/types/admin.ts` - Added ErrorLog, ErrorLogFilters, ErrorLogsResponse, ResolveErrorRequest types

- **Quality checks:**
  - ✅ TypeScript check passed (npx tsc --noEmit)
  - ✅ No linting errors
  - ✅ Updated prd.json to mark US-040 as passing

- **Learnings for future iterations:**
  - Error log management pattern: Table view for overview, modal for detailed inspection
  - Filter persistence: Reset to page 1 when any filter changes to avoid empty pages
  - CSV export: Fetch larger batch (1000) for export, format dates appropriately
  - Severity/status badges: Use color coding consistently (red=error, yellow=warning, blue=info, green=resolved, red=unresolved)
  - Code blocks: Use <pre> with proper styling for stack traces and JSON data
  - Modal pattern: Click overlay to close, stop propagation on content click
  - Superuser check: Redirect non-superusers immediately with toast message
  - Pagination: Always show results info ("Showing X of Y logs")
  - Date filters: Use native date input type for browser-native date picker

---
